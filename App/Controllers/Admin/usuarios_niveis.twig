{% extends "layout.twig" %}

{% block content %}
<div class="container mt-5">
  <h1>Gerenciar Níveis de Acesso</h1>

  {# Mensagens flash #}
  {% set mensagens = flash() %}
  {% if mensagens %}
    {% for msg in mensagens %}
      <div class="alert alert-{{ msg.tipo }}">
        <i class="fas fa-info-circle"></i> {{ msg.conteudo }}
      </div>
    {% endfor %}
  {% endif %}

  <table class="table table-bordered table-striped mt-3">
    <thead class="table-dark">
      <tr>
        <th>ID</th>
        <th>Nome</th>
        <th>Apelido</th>
        <th>Email</th>
        <th>Nível Atual</th>
        <th>Alterar Nível</th>
      </tr>
    </thead>
    <tbody>
      {% for user in usuarios %}
        <tr>
          <td>{{ user.id }}</td>
          <td>{{ user.nome }}</td>
          <td>{{ user.apelido }}</td>
          <td>{{ user.mail }}</td>
          <td>
            {% set levels = {1: 'Usuário', 2: 'Moderador', 3: 'Administrador'} %}
            <span class="badge bg-info">{{ levels[user.level]|default('Desconhecido') }}</span>
          </td>
          <td>
            <form method="post" action="{{ url('/usuarios/niveis/atualizar') }}" class="d-flex">
              <input type="hidden" name="csrf_token" value="{{ csrf_token }}">
              <input type="hidden" name="id" value="{{ user.id }}">
              <select name="level" class="form-select form-select-sm me-2">
                <option value="1" {{ user.level == 1 ? 'selected' : '' }}>Usuário</option>
                <option value="2" {{ user.level == 2 ? 'selected' : '' }}>Moderador</option>
                <option value="3" {{ user.level == 3 ? 'selected' : '' }}>Administrador</option>
              </select>
              <button type="submit" class="btn btn-sm btn-primary">Salvar</button>
            </form>
          </td>
        </tr>
      {% endfor %}
    </tbody>
  </table>

  <a href="{{ url('/painel') }}" class="btn btn-secondary mt-3">
    <i class="fas fa-arrow-left"></i> Voltar ao Painel
  </a>
</div>
{% endblock %}
