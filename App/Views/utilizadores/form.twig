{% extends "layouts/painel.twig" %}

{% block title %}
    {{ acao == 'criar' ? 'Novo utilizador' : 'Editar utilizador' }}
{% endblock %}

{% block content %}

<div class="page-header">
    <h1 class="page-title">
        {{ acao == 'criar' ? 'Criar utilizador' : 'Editar utilizador' }}
    </h1>
</div>

<div class="card" style="padding: 25px;">

    <form method="post"
          action="{{ acao == 'criar'
              ? url('/utilizadores/criar')
              : url('/utilizadores/editar/' ~ user.id) }}">

        <input type="hidden" name="_csrf" value="{{ csrf }}">

        {# NOME #}
        {% include 'components/input.twig' with {
            label: 'Nome',
            name: 'nome',
            value: form_old.nome ?? user.nome ?? '',
            errors: form_errors,
            placeholder: 'Nome completo'
        } %}

        {# EMAIL #}
        {% include 'components/input.twig' with {
            label: 'Email',
            name: 'email',
            type: 'email',
            value: form_old.email ?? user.email ?? '',
            errors: form_errors,
            placeholder: 'email@exemplo.com'
        } %}

        {# SENHA #}
        {% if acao == 'criar' %}
            {% include 'components/input.twig' with {
                label: 'Senha',
                name: 'senha',
                type: 'password',
                errors: form_errors
            } %}
        {% else %}
            {% include 'components/input.twig' with {
                label: 'Nova senha (opcional)',
                name: 'nova_senha',
                type: 'password',
                errors: form_errors
            } %}

            {% include 'components/input.twig' with {
                label: 'Confirmar nova senha',
                name: 'nova_senha2',
                type: 'password',
                errors: form_errors
            } %}
        {% endif %}

        {# NÍVEL #}
        <div class="form-group">
            <label class="form-label">Nível</label>

            {% set nivel_atual = form_old.nivel ?? user.nivel ?? 1 %}

            <select name="nivel" class="form-input">
                {% for n in [1,2,3] %}
                    <option value="{{ n }}" {{ n == nivel_atual ? 'selected' : '' }}>
                        {{ n }}
                    </option>
                {% endfor %}
            </select>

            {% if error(form_errors, 'nivel') %}
                <div class="form-error">{{ error(form_errors, 'nivel') }}</div>
            {% endif %}
        </div>

        {# ESTADO #}
        <div class="form-group">
            <label class="form-label">Estado</label>

            {% set estado_atual = form_old.estado ?? user.estado ?? 1 %}

            <select name="estado" class="form-input">
                <option value="1" {{ estado_atual == 1 ? 'selected' : '' }}>Ativo</option>
                <option value="0" {{ estado_atual == 0 ? 'selected' : '' }}>Inativo</option>
            </select>

            {% if error(form_errors, 'estado') %}
                <div class="form-error">{{ error(form_errors, 'estado') }}</div>
            {% endif %}
        </div>

        <div style="display:flex; justify-content:space-between; margin-top:25px;">
            <a href="{{ url('/utilizadores') }}" class="btn-sm btn-warning">
                Voltar
            </a>

            <button class="btn-primary">
                {{ acao == 'criar' ? 'Criar utilizador' : 'Guardar alterações' }}
            </button>
        </div>

    </form>

</div>

{% endblock %}