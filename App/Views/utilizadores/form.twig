{% extends "layouts/painel.twig" %}

{% block title %}
    {{ acao == 'criar' ? 'Novo utilizador' : 'Editar utilizador' }}
{% endblock %}

{% block content %}

<div class="page-header">
    <h1 class="page-title">
        {{ acao == 'criar' ? 'Criar utilizador' : 'Editar utilizador' }}
    </h1>
</div>

<div class="card" style="padding: 25px;">

    {% if form_errors %}
        <div class="alert alert-danger" style="margin-bottom: 20px;">
            <strong>Foram encontrados erros:</strong>
            <ul style="margin-top: 10px;">
                {% for erro in form_errors %}
                    <li>{{ erro }}</li>
                {% endfor %}
            </ul>
        </div>
    {% endif %}

    <form method="post" action="{{ acao == 'criar'
        ? url('/utilizadores/criar')
        : url('/utilizadores/editar/' ~ user.id) }}">

        <input type="hidden" name="_csrf" value="{{ csrf() }}">

        <!-- NOME -->
        <div class="form-group" style="margin-bottom: 18px;">
            <label class="form-label">Nome</label>
            <input type="text" name="nome" class="form-input"
                   value="{{ form_old.nome ?? user.nome ?? '' }}" required>
        </div>

        <!-- EMAIL -->
        <div class="form-group" style="margin-bottom: 18px;">
            <label class="form-label">Email</label>
            <input type="email" name="email" class="form-input"
                   value="{{ form_old.email ?? user.email ?? '' }}" required>
        </div>

        <!-- SENHA -->
        {% if acao == 'criar' %}
            <div class="form-group" style="margin-bottom: 18px;">
                <label class="form-label">Senha</label>
                <input type="password" name="senha" class="form-input" required>
            </div>
        {% else %}
            <div class="form-group" style="margin-bottom: 18px;">
                <label class="form-label">Nova senha (opcional)</label>
                <input type="password" name="nova_senha" class="form-input">
            </div>

            <div class="form-group" style="margin-bottom: 18px;">
                <label class="form-label">Confirmar nova senha</label>
                <input type="password" name="nova_senha2" class="form-input">
            </div>
        {% endif %}

        <!-- NÍVEL -->
        <div class="form-group" style="margin-bottom: 18px;">
            <label class="form-label">Nível</label>
            {% set nivel_atual = form_old.nivel ?? user.nivel ?? 1 %}
            <select name="nivel" class="form-input">
                {% for n in [1,2,3] %}
                    <option value="{{ n }}" {{ n == nivel_atual ? 'selected' : '' }}>
                        {{ n }}
                    </option>
                {% endfor %}
            </select>
        </div>

        <!-- ESTADO -->
        <div class="form-group" style="margin-bottom: 18px;">
            <label class="form-label">Estado</label>
            {% set estado_atual = form_old.estado ?? user.estado ?? 1 %}
            <select name="estado" class="form-input">
                <option value="1" {{ estado_atual == 1 ? 'selected' : '' }}>Ativo</option>
                <option value="0" {{ estado_atual == 0 ? 'selected' : '' }}>Inativo</option>
            </select>
        </div>

        <!-- BOTÕES -->
        <div style="display: flex; justify-content: space-between; margin-top: 25px;">
            <a href="{{ url('/utilizadores') }}" class="btn-sm btn-warning">
                Voltar
            </a>

            <button class="btn-primary">
                {{ acao == 'criar' ? 'Criar utilizador' : 'Guardar alterações' }}
            </button>
        </div>

    </form>

</div>

{% endblock %}