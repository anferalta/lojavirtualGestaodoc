{% extends "layouts/painel.twig" %}

{% block title %}
    {{ acao == 'criar' ? 'Novo Documento' : 'Editar Documento' }}
{% endblock %}

{% block content %}

    <div class="page-header">
        <h1 class="page-title">
            {{ acao == 'criar' ? 'Carregar Documento' : 'Editar Documento' }}
        </h1>
    </div>

    <div class="card" style="padding:25px; max-width:700px; margin:auto;">

        <form method="post"
              action="{{ acao == 'criar' ? url('/documentos/store') : url('/documentos/update/' ~ doc.id) }}"
              enctype="multipart/form-data">

            <input type="hidden" name="_csrf" value="{{ csrf }}">

            {# ============================
               TÍTULO
            ============================ #}
            <div class="form-group" style="margin-bottom:20px;">
                <label class="form-label">Título</label>

                <input type="text"
                       name="titulo"
                       class="form-input {{ form_errors.titulo is defined ? 'input-error' : '' }}"
                       placeholder="Título do documento"
                       value="{{ form_old.titulo ?? doc.titulo ?? '' }}">

                {% if form_errors.titulo is defined %}
                    <p class="form-error">{{ form_errors.titulo|first }}</p>
                {% endif %}
            </div>

            {# ============================
               DESCRIÇÃO
            ============================ #}
            <div class="form-group" style="margin-bottom:20px;">
                <label class="form-label">Descrição</label>

                <textarea name="descricao"
                          class="form-input {{ form_errors.descricao is defined ? 'input-error' : '' }}"
                          rows="3"
                          placeholder="Descrição do documento">{{ form_old.descricao ?? doc.descricao ?? '' }}</textarea>

                {% if form_errors.descricao is defined %}
                    <p class="form-error">{{ form_errors.descricao|first }}</p>
                {% endif %}
            </div>

            {# ============================
               FICHEIRO
            ============================ #}
            <div class="form-group" style="margin-bottom:20px;">
                <label class="form-label">Ficheiro</label>

                <input type="file"
                       name="ficheiro"
                       class="form-input {{ form_errors.ficheiro is defined ? 'input-error' : '' }}">

                {% if form_errors.ficheiro is defined %}
                    <p class="form-error">{{ form_errors.ficheiro|first }}</p>
                {% endif %}

                <small style="color:#6b7280; font-size:0.85rem;">
                    Extensões permitidas: {{ env.UPLOAD_ALLOWED_EXT }}<br>
                    Tamanho máximo: {{ (env.UPLOAD_MAX_SIZE / 1048576)|number_format(0) }} MB
                </small>
            </div>

            {# ============================
               BOTÕES
            ============================ #}
            <div style="display:flex; justify-content:space-between; margin-top:30px;">
                <a href="{{ url('/documentos') }}" class="btn-sm btn-warning">
                    Voltar
                </a>

                <button class="btn-primary">
                    {{ acao == 'criar' ? 'Carregar Documento' : 'Guardar Alterações' }}
                </button>
            </div>

        </form>
    </div>

{% endblock %}